<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>–ù–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</title>
    <link rel="stylesheet" href="{{ url_for('static', path='/styles2.css') }}">
    <style>
        .post-container { max-width: 700px; margin: 40px auto; background: #fff; padding: 40px; border-radius: 24px; border: 1px solid var(--color-border); }
        @media(max-width: 768px) { .post-container { margin: 0; border-radius: 0; border: none; padding: 20px; } }
        .hidden-group { display: none; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        
        .photo-upload-zone {
            border: 2px dashed var(--color-border);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #fafafa;
        }
        
        .photo-upload-zone:hover {
            border-color: var(--color-primary, #007AFF);
            background: #f0f8ff;
        }
        
        .photo-upload-zone.dragover {
            border-color: var(--color-primary, #007AFF);
            background: #e3f2fd;
        }
        
        .photo-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }
        
        .photo-item {
            position: relative;
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
            background: #f0f0f0;
        }
        
        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .photo-item .delete-btn {
            position: absolute;
            top: 4px;
            right: 4px;
            background: rgba(244, 67, 54, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .photo-item:hover .delete-btn {
            opacity: 1;
        }
        
        .photo-count {
            font-size: 13px;
            color: var(--color-text-light);
            margin-top: 8px;
        }
        
        .photo-count.max {
            color: #f44336;
        }
    </style>
</head>
<body>

    <header class="header-fixed">
        <div class="nav-container">
            <a href="/" class="logo">lais</a>
            <a href="/" class="btn btn-text">–û—Ç–º–µ–Ω–∞</a>
        </div>
    </header>

    <div class="post-container">
        <h1 style="margin-bottom: 30px;">–ü—Ä–æ–¥–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</h1>
        
        <form>
            <div class="form-group">
                <label class="label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                <select id="catSelect" class="input">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é...</option>
                    <option value="iphone">iPhone</option>
                    <option value="macbook">MacBook</option>
                    <option value="ipad">iPad</option>
                    <option value="other">–î—Ä—É–≥–æ–µ</option>
                </select>


                        <div id="iphoneBlock" class="hidden-group">
                            <div class="form-group">
                                <label class="label">–ú–æ–¥–µ–ª—å iPhone</label>
                                <select id="iphoneModel" class="input">
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å...</option>
                                    <option value="17">iPhone 17</option>
                                    <option value="17plus">iPhone 17 Plus</option>
                                    <option value="17pro">iPhone 17 Pro</option>
                                    <option value="17promax">iPhone 17 Pro Max</option>
                                    <option value="16">iPhone 16</option>
                                    <option value="16plus">iPhone 16 Plus</option>
                                    <option value="16pro">iPhone 16 Pro</option>
                                    <option value="16promax">iPhone 16 Pro Max</option>
                                    <option value="15pro">iPhone 15 Pro</option>
                                    <option value="15promax">iPhone 15 Pro Max</option>
                                    <option value="15">iPhone 15</option>
                                    <option value="14pro">iPhone 14 Pro</option>
                                    <option value="14promax">iPhone 14 Pro Max</option>
                                    <option value="14">iPhone 14</option>
                                    <option value="13pro">iPhone 13 Pro</option>
                                    <option value="13promax">iPhone 13 Pro Max</option>
                                    <option value="13">iPhone 13</option>
                                    <option value="12pro">iPhone 12 Pro</option>
                                    <option value="12promax">iPhone 12 Pro Max</option>
                                    <option value="12">iPhone 12</option>
                                    <option value="11pro">iPhone 11 Pro</option>
                                    <option value="11">iPhone 11</option>
                                    <option value="xsmax">iPhone XS Max</option>
                                    <option value="xs">iPhone XS</option>
                                    <option value="x">iPhone X</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="label">IMEI <a href="https://support.apple.com/ru-ru/HT204073" target="_blank" title="–ö–∞–∫ –Ω–∞–π—Ç–∏ IMEI">‚ùì</a></label>
                                <input type="text" class="input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 35XXXXXXXXXXXX" required>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                <div class="form-group">
                                    <label class="label">–°–æ—Å—Ç–æ—è–Ω–∏–µ –ê–ö–ë (%)</label>
                                    <input type="number" class="input" placeholder="95">
                                </div>
                            </div>
                        </div>

            <div id="macBlock" class="hidden-group">
                <div class="form-group">
                    <label class="label">–°–µ—Ä–∏—è MacBook</label>
                    <select id="macSeries" class="input">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Ä–∏—é...</option>
                        <option value="air">MacBook Air</option>
                        <option value="pro">MacBook Pro</option>
                    </select>
                </div>

                <div id="macAirSpecs" class="hidden-group" style="margin-bottom: 16px;">
                    <label class="label">–ß–∏–ø (Air)</label>
                    <select class="input">
                        <option>M1</option>
                        <option>M2</option>
                        <option>M3</option>
                        <option>Intel (–°—Ç–∞—Ä—ã–µ)</option>
                    </select>
                </div>

                <div id="macProSpecs" class="hidden-group" style="margin-bottom: 16px;">
                    <label class="label">–ß–∏–ø (Pro)</label>
                    <select class="input">
                        <option>M1 Pro / Max</option>
                        <option>M2 Pro / Max</option>
                        <option>M3 Pro / Max</option>
                        <option>Intel i7 / i9</option>
                    </select>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label class="label">–û–ó–£ (RAM)</label>
                        <select class="input"><option>8 GB</option><option>16 GB</option><option>18 GB</option><option>24 GB</option><option>32 GB+</option></select>
                    </div>
                    <div class="form-group">
                        <label class="label">SSD</label>
                        <select class="input"><option>256 GB</option><option>512 GB</option><option>1 TB+</option></select>
                    </div>
                </div>
            </div>

            <div id="commonSpecs" class="hidden-group" style="border-top: 1px solid var(--color-border); padding-top: 20px; margin-top: 20px;">
                
                <div class="form-group">
                    <label class="label">–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è (–æ—Ç–º–µ—Ç—å—Ç–µ, —á—Ç–æ –µ—Å—Ç—å)</label>
                    <div class="checkbox-group">
                        <label class="check-item"><input type="checkbox" name="has_original_box"> –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –∫–æ—Ä–æ–±–∫–∞</label>
                        <label class="check-item"><input type="checkbox" name="has_charger"> –ó–∞—Ä—è–¥–Ω—ã–π –±–ª–æ–∫</label>
                        <label class="check-item"><input type="checkbox" name="has_cable"> –ö–∞–±–µ–ª—å</label>
                        <label class="check-item"><input type="checkbox" name="has_receipt"> –ß–µ–∫ –æ –ø–æ–∫—É–ø–∫–µ</label>
                        <label class="check-item"><input type="checkbox" name="has_warranty"> –ì–∞—Ä–∞–Ω—Ç–∏—è</label>
                    </div>
                </div>

                <div class="form-group">
                    <label class="label">–¶–µ–Ω–∞ (‚Ç¨)</label>
                    <input type="number" class="input" style="font-size: 20px; font-weight: bold;">
                </div>

                <div class="form-group">
                    <label class="label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea class="input" id="description" rows="5" placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏..."></textarea>
                </div>

                <div class="form-group">
                    <label class="label">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ (–º–∞–∫—Å. 15 —à—Ç.)</label>
                    <div class="photo-upload-zone" id="photoUploadZone">
                        <div style="font-size: 32px; margin-bottom: 8px;">üì∏</div>
                        <div style="font-weight: 600; margin-bottom: 4px;">–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ</div>
                        <div style="font-size: 13px; color: var(--color-text-light);">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: JPG, PNG (–º–∞–∫—Å. 5 –ú–ë –∑–∞ —Ñ–æ—Ç–æ)</div>
                        <input type="file" id="photoInput" multiple accept="image/*" style="display: none;">
                    </div>
                    <div class="photo-gallery" id="photoGallery"></div>
                    <div class="photo-count" id="photoCount">0 / 15 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π</div>
                </div>

                <button type="button" id="publishBtn" class="btn btn-primary" style="width: 100%; padding: 16px; font-size: 16px;">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
            </div>

        </form>
    </div>

    <script>
        const catSelect = document.getElementById('catSelect');
        const iphoneBlock = document.getElementById('iphoneBlock');
        const macBlock = document.getElementById('macBlock');
        const commonSpecs = document.getElementById('commonSpecs');
        
        const macSeries = document.getElementById('macSeries');
        const macAirSpecs = document.getElementById('macAirSpecs');
        const macProSpecs = document.getElementById('macProSpecs');

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏
        const photoUploadZone = document.getElementById('photoUploadZone');
        const photoInput = document.getElementById('photoInput');
        const photoGallery = document.getElementById('photoGallery');
        const photoCount = document.getElementById('photoCount');
        let photos = [];
        const MAX_PHOTOS = 15;
        const MAX_FILE_SIZE = 5 * 1024 * 1024; // 5 –ú–ë

        // –û—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–∞–π–ª–æ–≤–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∑–æ–Ω—É
        photoUploadZone.addEventListener('click', () => photoInput.click());

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
        photoInput.addEventListener('change', (e) => {
            addPhotos(e.target.files);
            photoInput.value = ''; // –°–±—Ä–æ—Å input –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤—ã–±—Ä–∞—Ç—å —Ç–µ –∂–µ —Ñ–∞–π–ª—ã
        });

        // Drag & Drop
        photoUploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            photoUploadZone.classList.add('dragover');
        });

        photoUploadZone.addEventListener('dragleave', () => {
            photoUploadZone.classList.remove('dragover');
        });

        photoUploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            photoUploadZone.classList.remove('dragover');
            addPhotos(e.dataTransfer.files);
        });

        function addPhotos(files) {
            const availableSlots = MAX_PHOTOS - photos.length;
            let added = 0;

            for (let file of files) {
                if (added >= availableSlots) break;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
                if (file.size > MAX_FILE_SIZE) {
                    alert(`–§–∞–π–ª ${file.name} —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å. 5 –ú–ë)`);
                    continue;
                }

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
                if (!file.type.startsWith('image/')) {
                    alert(`${file.name} –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º`);
                    continue;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    photos.push({
                        file: file,
                        preview: e.target.result
                    });
                    renderPhotos();
                };
                reader.readAsDataURL(file);
                added++;
            }

            if (added < files.length && photos.length >= MAX_PHOTOS) {
                alert(`–ú–∞–∫—Å–∏–º—É–º –¥–æ—Å—Ç–∏–≥–Ω—É—Ç! –ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ–ª—å–∫–æ ${MAX_PHOTOS} —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π`);
            }
        }

        function renderPhotos() {
            photoGallery.innerHTML = '';
            photos.forEach((photo, index) => {
                const photoItem = document.createElement('div');
                photoItem.className = 'photo-item';
                photoItem.innerHTML = `
                    <img src="${photo.preview}" alt="Photo ${index + 1}">
                    <button class="delete-btn" data-index="${index}">‚úï</button>
                `;
                
                photoItem.querySelector('.delete-btn').addEventListener('click', () => {
                    photos.splice(index, 1);
                    renderPhotos();
                });
                
                photoGallery.appendChild(photoItem);
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á—ë—Ç—á–∏–∫
            photoCount.textContent = `${photos.length} / ${MAX_PHOTOS} —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π`;
            if (photos.length >= MAX_PHOTOS) {
                photoCount.classList.add('max');
                photoUploadZone.style.opacity = '0.5';
                photoUploadZone.style.pointerEvents = 'none';
            } else {
                photoCount.classList.remove('max');
                photoUploadZone.style.opacity = '1';
                photoUploadZone.style.pointerEvents = 'auto';
            }
        }

        // –ì–ª–∞–≤–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è
        catSelect.addEventListener('change', (e) => {
            const val = e.target.value;
            
            // –°–±—Ä–æ—Å
            iphoneBlock.style.display = 'none';
            macBlock.style.display = 'none';
            commonSpecs.style.display = 'none';

            if(val === 'iphone') {
                iphoneBlock.style.display = 'block';
                commonSpecs.style.display = 'block';
            } else if(val === 'macbook') {
                macBlock.style.display = 'block';
                commonSpecs.style.display = 'block';
            } else if (val) {
                commonSpecs.style.display = 'block';
            }
        });

        // –õ–æ–≥–∏–∫–∞ MacBook (Air vs Pro)
        macSeries.addEventListener('change', (e) => {
            const val = e.target.value;
            macAirSpecs.style.display = 'none';
            macProSpecs.style.display = 'none';

            if(val === 'air') {
                macAirSpecs.style.display = 'block';
            } else if(val === 'pro') {
                macProSpecs.style.display = 'block';
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã –Ω–∞ Posts API
        document.getElementById('publishBtn').addEventListener('click', async (e) => {
            e.preventDefault();
            
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –≤–æ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏
            const publishBtn = document.getElementById('publishBtn');
            publishBtn.disabled = true;
            publishBtn.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
            
            try {
                // –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –≤ Cloudflare
                let imageUrls = [];
                if (photos.length > 0) {
                    console.log(`–ó–∞–≥—Ä—É–∂–∞–µ–º ${photos.length} —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤ Cloudflare...`);
                    imageUrls = await uploadPhotosToCloudflare(photos);
                    
                    if (imageUrls.length === 0) {
                        alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏');
                        publishBtn.disabled = false;
                        publishBtn.textContent = '–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å';
                        return;
                    }
                    console.log('–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', imageUrls);
                }

                // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è —Ñ–æ—Ä–º—ã
                const formData = new FormData();
                
                // IMEI
                const imeiInput = document.querySelector('input[placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 35XXXXXXXXXXXX"]');
                if (imeiInput && imeiInput.value) {
                    formData.append('imei', imeiInput.value);
                }
                
                // –ë–∞—Ç–∞—Ä–µ—è
                const batteryInput = document.querySelector('input[placeholder="95"]');
                if (batteryInput && batteryInput.value) {
                    formData.append('batery', batteryInput.value);
                }
                
                // –û–ø–∏—Å–∞–Ω–∏–µ
                const description = document.getElementById('description').value;
                if (description) {
                    formData.append('description', description);
                }
                
                // –ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è (checkboxes)
                formData.append('has_original_box', document.querySelector('input[name="has_original_box"]').checked);
                formData.append('has_charger', document.querySelector('input[name="has_charger"]').checked);
                formData.append('has_cable', document.querySelector('input[name="has_cable"]').checked);
                formData.append('has_receipt', document.querySelector('input[name="has_receipt"]').checked);
                formData.append('has_warranty', document.querySelector('input[name="has_warranty"]').checked);
                
                // –î–æ–±–∞–≤–ª—è–µ–º URL —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤–º–µ—Å—Ç–æ —Å–∞–º–∏—Ö —Ñ–∞–π–ª–æ–≤
                if (imageUrls.length > 0) {
                    formData.append('images_url', imageUrls.join(','));
                }
                
                console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ Posts API...');
                const response = await fetch('http://localhost:3000/api/v1/iphone', {
                    method: 'POST',
                    body: formData,
                    credentials: 'include' // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º cookies —Å JWT —Ç–æ–∫–µ–Ω–æ–º
                });
                
                if (response.ok) {
                    const data = await response.json();
                    alert(`–ü–æ—Å—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω! ID: ${data.id}`);
                    // –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–æ–¥—É–∫—Ç–∞
                    window.location.href = `http://localhost:5500/product?id=${data.id}`;
                } else {
                    const error = await response.json();
                    console.log(error.detail)
                    alert(`–û—à–∏–±–∫–∞: ${error.detail || '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ø–æ—Å—Ç'}`);
                }
            } catch (error) {
                console.log(error)
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ:', error);
                alert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É');
            } finally {
                publishBtn.disabled = false;
                publishBtn.textContent = '–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å';
            }
        });

        /**
         * –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –Ω–∞–ø—Ä—è–º—É—é –≤ Cloudflare R2
         * @param {Array} photosArray - –ú–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ —Å file –∏ preview
         * @returns {Promise<Array>} –ú–∞—Å—Å–∏–≤ URL –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
         */
        async function uploadPhotosToCloudflare(photosArray) {
            const uploadedUrls = [];

            try {
                for (let i = 0; i < photosArray.length; i++) {
                    const photo = photosArray[i];
                    
                    try {
                        // –î–ª—è –∫–∞–∂–¥–æ–π —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –ø–æ–ª—É—á–∞–µ–º —Å–≤–æ–π URL –∑–∞–≥—Ä—É–∑–∫–∏
                        console.log(`–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º URL –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ ${i + 1}/${photosArray.length}...`);
                        const urlResponse = await fetch('http://localhost:3000/api/v1/r2_link');
                        
                        if (!urlResponse.ok) {
                            throw new Error(`–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è URL: ${urlResponse.status}`);
                        }
                        
                        const linkData = await urlResponse.json();
                        const uploadUrl = linkData.upload_url;
                        const imageDeliveryBase = linkData.image_delivery_base;

                        console.log(`–ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–æ—Ç–æ ${i + 1}/${photosArray.length}...`);
                        console.log(`–¢–∏–ø —Ñ–∞–π–ª–∞: ${photo.file.type}, –†–∞–∑–º–µ—Ä: ${(photo.file.size / 1024).toFixed(2)} KB`);

                        // –°–æ–∑–¥–∞–µ–º FormData –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ (Cloudflare –æ–∂–∏–¥–∞–µ—Ç –∏–º–µ–Ω–Ω–æ —ç—Ç–æ)
                        const formData = new FormData();
                        formData.append('file', photo.file);  // –í–ê–ñ–ù–û: –∫–ª—é—á –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 'file'

                        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª –≤ Cloudflare
                        const uploadResponse = await fetch(uploadUrl, {
                            method: 'POST',
                            body: formData
                            // –ù–ï —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Content-Type - –±—Ä–∞—É–∑–µ—Ä —Å–∞–º —É—Å—Ç–∞–Ω–æ–≤–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π multipart/form-data
                        });

                        console.log(`–û—Ç–≤–µ—Ç Cloudflare: ${uploadResponse.status} ${uploadResponse.statusText}`);

                        if (!uploadResponse.ok) {
                            const errorText = await uploadResponse.text();
                            console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–æ—Ç–æ ${i + 1}: ${uploadResponse.status}`);
                            console.error(`–¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏: ${errorText}`);
                            continue;
                        }

                        // –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –æ—Ç Cloudflare —Å —Ä–µ–∞–ª—å–Ω—ã–º image_id
                        const cloudflareResponse = await uploadResponse.json();
                        console.log(`–û—Ç–≤–µ—Ç Cloudflare (–ø–æ–ª–Ω—ã–π):`, cloudflareResponse);
                        
                        const imageId = cloudflareResponse.result.id;
                        const publicUrl = `${imageDeliveryBase}/${imageId}/test`;
                        
                        console.log(`‚úì –ü—É–±–ª–∏—á–Ω—ã–π URL: ${publicUrl}`);
                        
                        uploadedUrls.push(publicUrl);
                        console.log(`–§–æ—Ç–æ ${i + 1} —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞: ${publicUrl}`);

                    } catch (error) {
                        console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–æ—Ç–æ ${i + 1}:`, error);
                        // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ñ–æ—Ç–æ –¥–∞–∂–µ –µ—Å–ª–∏ –æ–¥–Ω–∞ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å
                    }
                }

                console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${uploadedUrls.length} –∏–∑ ${photosArray.length} —Ñ–æ—Ç–æ`);
                return uploadedUrls;

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤ Cloudflare:', error);
                return [];
            }
        }
    </script>

</body>
</html>