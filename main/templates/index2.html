<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lais</title>
    <link rel="stylesheet" href="{{ url_for('static', path='/styles2.css') }}">
</head>
<body>

    <header class="header-fixed">
        <div class="nav-container">
            <a href="/" class="logo">lais</a>
            <div style="flex:1"></div> <div class="header-controls">
                <button class="btn btn-text" id="loginBtn">–í–æ–π—Ç–∏</button>
                <a href="/post-ad" id="postAdBtn" class="btn btn-primary">–†–∞–∑–º–µ—Å—Ç–∏—Ç—å</a>
            </div>
        </div>
    </header>

    <section class="hero-section">
        <h1 class="hero-title">–ö—É–ø–∏. –ü—Ä–æ–¥–∞–π. –û–±–Ω–æ–≤–∏—Å—å.</h1>
        <p class="hero-text">–õ—É—á—à–µ–µ –º–µ—Å—Ç–æ –¥–ª—è —Ç–µ—Ö–Ω–∏–∫–∏ Apple –∏ –Ω–µ —Ç–æ–ª—å–∫–æ.</p>
    </section>

    <div class="category-scroll">
        <div class="cat-pill active">–í—Å–µ</div>
        <div class="cat-pill">iPhone</div>
        <div class="cat-pill">MacBook</div>
        <div class="cat-pill">iPad</div>
        <div class="cat-pill">AirPods</div>
        <div class="cat-pill">Watch</div>
        <div class="cat-pill">–ö–æ–Ω—Å–æ–ª–∏</div>
    </div>

    <main class="main-container">
        <div class="product-grid">
            <a href="/product" style="text-decoration: none; color: inherit;">
                <div style="background: #fff; border-radius: 16px; overflow: hidden; border: 1px solid var(--color-border);">
                    <div style="height: 200px; background: #f5f5f7; display: flex; align-items: center; justify-content: center;">
                        <span style="font-weight: 600; color: #ccc;">IMG</span>
                    </div>
                    <div style="padding: 16px;">
                        <div style="font-weight: 700; font-size: 18px;">‚Ç¨1,250</div>
                        <div style="font-size: 15px; margin-bottom: 6px;">iPhone 14 Pro Max 256GB</div>
                        <div style="font-size: 12px; color: #86868b;">–†–∏–≥–∞ ‚Ä¢ –í—á–µ—Ä–∞</div>
                    </div>
                </div>
            </a>
            </div>
    </main>

    <div class="modal" id="authModal">
        <div class="modal-box">
            <div style="text-align: right;">
                <button id="closeModal" style="background:none; border:none; cursor:pointer; font-size:24px; color: var(--color-text-light);">&times;</button>
            </div>
            
            <div class="auth-header">
                <h2>–í—Ö–æ–¥ –≤ Lais</h2>
                <p>–£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–≤–æ–∏–º–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è–º–∏ –∏ –ø–æ–∫—É–ø–∫–∞–º–∏</p>
            </div>

            <div style="display: flex; gap: 16px; margin-bottom: 24px; border-bottom: 1px solid var(--co</button>lor-border);">
                <button class="btn-tab" onclick="switchTab('login')" style="border: none; border-bottom: 2px solid var(--color-primary); color: var(--color-text); padding: 12px 0; flex: 1; background: none; cursor: pointer; font-weight: 600;">–í—Ö–æ–¥</button>
                <button class="btn-tab" onclick="switchTab('register')" style="border: none; border-bottom: 2px solid transparent; color: var(--color-text-light); padding: 12px 0; flex: 1; background: none; cursor: pointer; font-weight: 600;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            </div>

            <div id="loginForm">

                <div class="oauth-buttons">
                    <a href="http://localhost:8000/auth/google/login" class="oauth-btn google">
                        <svg viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                        –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å Google
                    </a>
                    <button class="oauth-btn facebook">
                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                        –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å Facebook
                    </button>
                    <button class="oauth-btn apple">
                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M12.152 6.896c-.948 0-2.415-1.078-3.96-1.04-2.04.027-3.91 1.183-4.961 3.014-2.127 3.675-.552 9.12 1.519 12.123.987 1.431 2.178 3.065 3.749 3.007 1.497-.056 2.06-.967 3.866-.967 1.785 0 2.316.967 3.863.967 1.626 0 2.786-1.488 3.807-2.958 1.165-1.683 1.651-3.315 1.681-3.399-.037-.018-3.265-1.248-3.3-4.946-.034-3.093 2.536-4.569 2.664-4.656-1.453-2.124-3.707-2.363-4.515-2.389-1.02-.032-2.344.599-3.081.599-.739 0-1.947-.556-2.333-.355zM12.752 4.55c.846-1.021 1.418-2.438 1.262-3.853-1.222.049-2.7 .813-3.578 1.839-.787.914-1.471 2.378-1.286 3.78 1.363.105 2.753-.745 3.602-1.766z"/></svg>
                        –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å Apple
                    </a>
                </div>

                <div class="divider"><span>–∏–ª–∏ –ø–æ email</span></div>

                <form id="emailAuthForm">
                    <div class="form-group">
                        <input type="text" class="form-input" placeholder="Email or username" required>
                        <span style="color: red;" class="error-message"></span>
                    </div>
                    <div class="form-group">
                        <input type="password" class="form-input" placeholder="–ü–∞—Ä–æ–ª—å" required>
                        <span style="color: red;" class="error-message"></span>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center;">–í–æ–π—Ç–∏</button>
                </form>

            </div>

            <div id="registerForm" style="display: none;">
                <form id="emailRegisterForm" onsubmit="event.preventDefault()">
                    <div class="form-group">
                        <input type="email" class="form-input" placeholder="Email" required>
                        <span style="color: red;" class="error-message"></span>
                    </div>
                    <div class="form-group">
                        <input type="text" class="form-input" placeholder="–ù–∏–∫" required>
                        <span style="color: red;" class="error-message"></span>
                    </div>
                    <div class="form-group">
                        <input type="password" class="form-input" placeholder="–ü–∞—Ä–æ–ª—å" required>
                        <span style="color: red;" class="error-message"></span>
                    </div>
                    <div class="form-group">
                        <input type="password" class="form-input" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–∞—Ä–æ–ª—å" required>
                        <span style="color: red;" class="error-message"></span>
                    </div>
                    <div class="form-group" style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" id="termsCheck" required style="width: 18px; height: 18px; cursor: pointer;">
                        <label for="termsCheck" style="font-size: 13px; color: var(--color-text-light); cursor: pointer;">–Ø —Å–æ–≥–ª–∞—Å–µ–Ω —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –ø–ª–æ—â–∞–¥–∫–∏</label>
                    </div>
                    <span class="error-message" style="display: block; margin-bottom: 12px;"></span>
                    <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center;">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                </form>
            </div>

        </div>

    </div>

    <style>
    /* –°—Ç–∏–ª–∏ –¥–ª—è Cookie –ú–æ–¥–∞–ª–∫–∏ */
    #cookieConsentModal {
        display: none;
        position: fixed;
        bottom: 24px;
        right: 24px;
        width: 340px;
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.15);
        border: 1px solid var(--color-border, #e5e5e5);
        padding: 24px;
        z-index: 9999;
        animation: slideIn 0.3s ease-out;
    }

    #cookieConsentModal.active {
        display: block;
    }

    @keyframes slideIn {
        from { transform: translateY(20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –ú–µ–Ω—é –ü—Ä–æ—Ñ–∏–ª—è –≤ –•–µ–¥–µ—Ä–µ */
    .user-profile-wrapper {
        position: relative;
        margin-left: 12px;
        display: inline-block;
    }

    .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: #f5f5f7;
        background-image: url('https://ui-avatars.com/api/?name=User&background=0D8ABC&color=fff'); /* –î–µ—Ñ–æ–ª—Ç–Ω–∞—è –∞–≤–∞—Ç–∞—Ä–∫–∞ */
        background-size: cover;
        background-position: center;
        cursor: pointer;
        border: 1px solid var(--color-border, #e5e5e5);
        transition: transform 0.2s;
    }

    .user-avatar:hover {
        transform: scale(1.05);
    }

    /* –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é */
    .profile-dropdown {
        display: none;
        position: absolute;
        top: 100%;
        right: 0;
        margin-top: 12px;
        width: 200px;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.12);
        border: 1px solid var(--color-border, #e5e5e5);
        overflow: hidden;
        flex-direction: column;
    }

    .user-profile-wrapper:hover .profile-dropdown {
        display: flex;
    }

    .profile-dropdown a, 
    .profile-dropdown button {
        display: block;
        padding: 12px 16px;
        text-decoration: none;
        color: var(--color-text, #1d1d1f);
        font-size: 14px;
        text-align: left;
        background: none;
        border: none;
        cursor: pointer;
        transition: background 0.2s;
        width: 100%;
        font-family: inherit;
    }

    .profile-dropdown a:hover, 
    .profile-dropdown button:hover {
        background-color: #f5f5f7;
    }

    .profile-dropdown .divider {
        height: 1px;
        background-color: var(--color-border, #e5e5e5);
        margin: 0;
    }
    
    .logout-btn {
        color: #ff3b30 !important;
    }
</style>

<div id="cookieConsentModal">
    <h3 style="font-size: 18px; font-weight: 600; margin: 0 0 8px 0;">–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º Cookies üç™</h3>
    <p style="font-size: 13px; color: #86868b; margin: 0 0 16px 0; line-height: 1.4;">
        –ü—Ä–æ–¥–æ–ª–∂–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å–∞–π—Ç–æ–º, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ñ–∞–π–ª–æ–≤ cookie –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–∞.
    </p>
    <button id="acceptCookiesBtn" class="btn btn-primary" style="width: 100%; justify-content: center;">
        –•–æ—Ä–æ—à–æ
    </button>
</div>

<script>
(function() {
    // ==========================================
    // 1. –õ–û–ì–ò–ö–ê COOKIE MODAL (–û—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –±—ã–ª–æ)
    // ==========================================
    const cookieModal = document.getElementById('cookieConsentModal');
    const acceptBtn = document.getElementById('acceptCookiesBtn');
    
    if (!localStorage.getItem('lais_cookie_consent')) {
        setTimeout(() => {
            cookieModal.classList.add('active');
        }, 1000);
    }

    acceptBtn.addEventListener('click', () => {
        localStorage.setItem('lais_cookie_consent', 'true');
        cookieModal.classList.remove('active');
    });

    // ==========================================
    // 2. –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò (–ß–µ—Ä–µ–∑ /auth/me)
    // ==========================================
    
    async function checkAuthAndBuildUI() {
        try {
            // –î–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å –∫ /auth/me. 
            // –í–∞–∂–Ω–æ: credentials: 'include' –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –±—Ä–∞—É–∑–µ—Ä –æ—Ç–ø—Ä–∞–≤–∏—Ç—å HttpOnly cookie –≤–º–µ—Å—Ç–µ —Å –∑–∞–ø—Ä–æ—Å–æ–º.
            const response = await fetch('http://localhost:8000/auth/me', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                },
                credentials: 'include' 
            });

            // –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å 200 - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ª–æ–≥–∏–Ω–µ–Ω
            if (response.ok) {
                const userData = await response.json();
                updateUIForLoggedInUser(userData);
            }
            if (response.status === 401) {
                const refresh_response = await fetch('http://localhost:8000/auth/refresh', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                },
                credentials: 'include' 
            });
                if (refresh_response.status === 401) {
                    console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω");
                    return;
                }
            }
            // –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å 401 - —Ç–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–µ–Ω –∏–ª–∏ –µ–≥–æ –Ω–µ—Ç, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º (–∫–Ω–æ–ø–∫–∞ "–í–æ–π—Ç–∏" –æ—Å—Ç–∞–µ—Ç—Å—è)
        } catch (error) {
            console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏–ª–∏ –æ—à–∏–±–∫–∞ —Å–µ—Ç–∏");
        }
    }

    function updateUIForLoggedInUser(user) {
        // –ê. –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–í–æ–π—Ç–∏"
        const loginBtn = document.getElementById('loginBtn');
        if (loginBtn) loginBtn.style.display = 'none';

        // –ë. –î–æ–±–∞–≤–ª—è–µ–º –ê–≤–∞—Ç–∞—Ä–∫—É
        const headerControls = document.querySelector('.header-controls');
        if (headerControls) {
            // –§–æ—Ä–º–∏—Ä—É–µ–º –∞–≤–∞—Ç–∞—Ä–∫—É —Å –∏–Ω–∏—Ü–∏–∞–ª–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const avatarUrl = `https://ui-avatars.com/api/?name=${user.username}&background=0D8ABC&color=fff`;

            const profileWrapper = document.createElement('div');
            profileWrapper.className = 'user-profile-wrapper';
            
            profileWrapper.innerHTML = `
                <div class="user-avatar" style="background-image: url('${avatarUrl}')" onclick="window.location.href='/profile'"></div>
                <div class="profile-dropdown">
                    <div style="padding: 12px 16px; border-bottom: 1px solid #eee; font-weight: 600; color: #888; font-size: 12px;">
                        ${user.username}
                    </div>
                    <a href="/profile">üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</a>
                    <a href="/profile/edit">‚öôÔ∏è –°–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</a>
                    <div class="divider"></div>
                    <button class="logout-btn" id="logoutAction">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</button>
                </div>
            `;
            
            headerControls.appendChild(profileWrapper);
            
            // –í. –õ–æ–≥–∏–∫–∞ –í—ã—Ö–æ–¥–∞ (Logout)
            document.getElementById('logoutAction').addEventListener('click', async (e) => {
                e.stopPropagation(); 
                try {
                    await fetch('http://localhost:8000/auth/logout', {
                        method: 'POST',
                        credentials: 'include' // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, —á—Ç–æ–±—ã —Å–µ—Ä–≤–µ—Ä –ø–æ–Ω—è–ª, —á—å—é –∫—É–∫—É —É–¥–∞–ª—è—Ç—å
                    });
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞
                    window.location.reload();
                } catch (err) {
                    console.error('Logout failed', err);
                    window.location.reload();
                }
            });
        }
    }

    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∫—Ä–∏–ø—Ç–∞
    checkAuthAndBuildUI();

})();
</script>

    <script>
        const modal = document.getElementById('authModal');
        const loginBtn = document.getElementById('loginBtn');
        const closeBtn = document.getElementById('closeModal');
        
        // --- –ù–û–í–´–ô –ö–û–î –ù–ê–ß–ê–õ–û ---
        const postAdBtn = document.getElementById('postAdBtn');

        postAdBtn.addEventListener('click', (e) => {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            // (–º—ã —Å–æ–∑–¥–∞–µ–º .user-profile-wrapper –≤ –ø–µ—Ä–≤–æ–º —Å–∫—Ä–∏–ø—Ç–µ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –≤—Ö–æ–¥–µ)
            const isUserLoggedIn = document.querySelector('.user-profile-wrapper');

            if (!isUserLoggedIn) {
                e.preventDefault(); // –û—Ç–º–µ–Ω—è–µ–º –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ —Å—Å—ã–ª–∫–µ
                modal.classList.add('active'); // –û—Ç–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ –≤—Ö–æ–¥–∞
                
            }
            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ª–æ–≥–∏–Ω–µ–Ω, —Å–∫—Ä–∏–ø—Ç –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç, 
        });

        loginBtn.onclick = () => modal.classList.add('active');
        closeBtn.onclick = () => modal.classList.remove('active');
        window.onclick = (e) => { if (e.target === modal) modal.classList.remove('active'); }

        function switchTab(tab) {
            const loginForm = document.getElementById('loginForm');
            const regForm = document.getElementById('registerForm');
            const tabs = document.querySelectorAll('.btn-tab');
            
            if(tab === 'login') {
                loginForm.style.display = 'block';
                regForm.style.display = 'none';
                tabs[0].style.borderColor = 'var(--color-primary)';
                tabs[0].style.color = 'var(--color-text)';
                tabs[1].style.borderColor = 'transparent';
                tabs[1].style.color = 'var(--color-text-light)';
            } else {
                loginForm.style.display = 'none';
                regForm.style.display = 'block';
                tabs[1].style.borderColor = 'var(--color-primary)';
                tabs[1].style.color = 'var(--color-text)';
                tabs[0].style.borderColor = 'transparent';
                tabs[0].style.color = 'var(--color-text-light)';
            }
        }

        // Login Form Handling

        document.getElementById('emailAuthForm').addEventListener('submit', async (e) => {
                        e.preventDefault();
                        const form = e.target;
                        const inputs = form.querySelectorAll('.form-input');
                        const [username_or_email, passInput] = inputs;
                        const errorMessages = form.querySelectorAll('.error-message');
                        
                        errorMessages.forEach(err => err.textContent = '');
                        
                        let hasError = false;
                        
                        if (hasError) return;
                        
                        const data = {
                            username_or_email: username_or_email.value,
                            password: passInput.value
                        };
                        
                        try {
                            const response = await fetch('http://localhost:8000/auth/login', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(data),
                                credentials: 'include'
                            });
                            const result = await response.json();
                            
                            if (response.status === 406) {
                                if (result.errors) {
                                    if (result.errors.auth) {
                                        errorMessages[0].textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å';
                                    }
                                }
                            } else if (response.ok) {
                                console.log("Successful login");
                                window.location.href = '/';
                            }
                        } catch (err) {
                            console.error(err);
                        }
                    });
                    
                    document.getElementById('emailAuthForm').querySelectorAll('.form-input').forEach(input => {
                        input.addEventListener('input', (e) => {
                            e.target.parentElement.querySelector('.error-message').textContent = '';
                        });
                    });

        // Registration Form Handling

        document.getElementById('emailRegisterForm').addEventListener('submit', async (e) => {
                        e.preventDefault();
                        const form = e.target;
                        const inputs = form.querySelectorAll('.form-input');
                        const [emailInput, nickInput, passInput, confirmPassInput] = inputs;
                        const termsCheck = form.querySelector('#termsCheck');
                        const errorMessages = form.querySelectorAll('.error-message');
                        
                        errorMessages.forEach(err => err.textContent = '');
                        
                        let hasError = false;
                        
                        if (passInput.value !== confirmPassInput.value) {
                            errorMessages[3].textContent = '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
                            hasError = true;
                        }

                        if (passInput.value.length < 8) {
                            errorMessages[3].textContent = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 8 —Å–∏–º–≤–æ–ª–æ–≤';
                            hasError = true;
                        }
                        
                        if (!termsCheck.checked) {
                            errorMessages[4].textContent = '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏—Ç—å—Å—è —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏';
                            hasError = true;
                        }
                        
                        if (hasError) return;
                        
                        const data = {
                            email: emailInput.value,
                            username: nickInput.value,
                            password: passInput.value
                        };
                        
                        try {
                            const response = await fetch('http://localhost:8000/auth/register', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(data),
                                credentials: 'include'
                            });
                            const result = await response.json();
                            
                            if (response.status === 406) {
                                if (result.errors) {
                                    if (result.errors.email) {
                                        errorMessages[0].textContent = '–¢–∞–∫–∞—è –ø–æ—á—Ç–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç';
                                    }
                                    if (result.errors.username) {
                                        errorMessages[1].textContent = '–¢–∞–∫–æ–π –Ω–∏–∫–Ω–µ–π–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç';
                                    }
                                }
                            } else if (response.ok) {
                                window.location.href = '/';
                            }
                        } catch (err) {
                            console.error(err);
                        }
                    });
                    
                    document.getElementById('emailRegisterForm').querySelectorAll('.form-input').forEach(input => {
                        input.addEventListener('input', (e) => {
                            e.target.parentElement.querySelector('.error-message').textContent = '';
                        });
                    });
    </script>
</body>
</html>